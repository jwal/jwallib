<!DOCTYPE html>
<html>
  <head>
    <title>Git Browser</title>
    <link rel="stylesheet" href="style/main.css" type="text/css">
  </head>
  <body>
    <div id="account"></div>
    <h1>Git Browser</h1>
    <div id="main_body">
    </div>
  </body>
  <script src="vendor/couchapp/loader.js"></script>
  <script type="text/javascript" charset="utf-8">
    function startswith(string, prefix)
    {
      return (string.length >= prefix.length 
              && string.substring(0, prefix.length) == prefix);
    }
    function trim_prefix(string, prefix)
    {
      if (!startswith(string, prefix))
      {
        throw new Error("String missing prefix: string=" + string
                        + " prefix= " + prefix);
      }
      return string.substring(prefix.length, 
                              string.length - prefix.length + 1);
    }
    $.couch.app(function(app) {
      $("#account").evently("account", app);
      $.evently.connect("#account","#profile", ["loggedIn","loggedOut"]);
      if (location.hash == "" || location.hash == "#")
      {
        location.hash = "#git-branches";
      }
      $(window).hashchange(function() {
        $("#main_body").html("<em>Loading...</em>");
        if (location.hash == "#git-branches")
        {
          $("#main_body").evently("branches", app);
        }
        else if (startswith(location.hash, "#git-branch-"))
        {
          var uri = (app.db.uri 
                     + $.couch.encodeDocId(trim_prefix(location.hash, "#")));
          $.get(uri, {}, {"success": function(data) {
            console.debug(data);
          }});
        }
        else
        {
          $("#main_body").html(
            '<em>Failed to load.  Try going ' + 
            '<a href="javascript: history.go(-1)">back</a>.</em>');
        }
      });
      $(window).hashchange();
    });
  </script>
</html>
